(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{"56Cj":function(t,e,n){var i=n("ct80");t.exports=!!Object.getOwnPropertySymbols&&!i((function(){return!String(Symbol())}))},KQNt:function(t,e,n){var i=n("9JhN");t.exports=i.Promise},Qavd:function(t,e,n){"use strict";var i=n("ax0f"),a=n("DpO5"),o=n("KQNt"),s=n("ct80"),r=n("VCi3"),c=n("Qzre"),l=n("nDYR"),u=n("uLp7");i({target:"Promise",proto:!0,real:!0,forced:!!o&&s((function(){o.prototype.finally.call({then:function(){}},(function(){}))}))},{finally:function(t){var e=c(this,r("Promise")),n="function"==typeof t;return this.then(n?function(n){return l(e,t()).then((function(){return n}))}:t,n?function(n){return l(e,t()).then((function(){throw n}))}:t)}}),a||"function"!=typeof o||o.prototype.finally||u(o.prototype,"finally",r("Promise").prototype.finally)},Qgfn:function(t,e,n){"use strict";n.r(e);var i,a=n("BFfR"),o=n("NMl0"),s=n("9fIP"),r=n("MMYH"),c=n("K/z8"),l=n("sRHE"),u=n("PRnZ"),f=n("8K1b"),h=n("D8sA"),p=n("8eia"),g=n("TjKm"),d=n("CPJl"),v=n("u/Ma"),y=(n("Qavd"),n("zjfJ")),m=n("Tps+"),_=n("fuuL"),x=n("mLT2"),b=n("lwtq"),O=n("pcDJ"),P=n("RX7e"),w=n("02NV"),M=function(){},C=(i={},Object(y.a)(i,10241,9987),Object(y.a)(i,10240,9729),Object(y.a)(i,10242,33071),Object(y.a)(i,10243,33071),i);function z(t){return t&&(t.id||t.url)}function I(t,e,n){for(var i=0;i<e.length;i++){var a=e[i],o=a.icon,s=a.xOffset;t[z(o)]=Object.assign({},o,{x:s,y:n})}}var j=function(){function t(e,n){var i=n.onUpdate,a=void 0===i?M:i;Object(s.a)(this,t),this.gl=e,this.onUpdate=a,this._loadOptions=null,this._getIcon=null,this._texture=null,this._externalTexture=null,this._mapping={},this._pendingCount=0,this._autoPacking=!1,this._xOffset=0,this._yOffset=0,this._rowHeight=0,this._buffer=4,this._canvasWidth=1024,this._canvasHeight=0,this._canvas=null}return Object(r.a)(t,[{key:"finalize",value:function(){this._texture&&this._texture.delete()}},{key:"getTexture",value:function(){return this._texture||this._externalTexture}},{key:"getIconMapping",value:function(t){var e=this._autoPacking?z(t):t;return this._mapping[e]||{}}},{key:"setProps",value:function(t){var e=t.loadOptions,n=t.autoPacking,i=t.iconAtlas,a=t.iconMapping,o=t.data,s=t.getIcon;e&&(this._loadOptions=e),void 0!==n&&(this._autoPacking=n),s&&(this._getIcon=s),a&&(this._mapping=a),i&&this._updateIconAtlas(i),this._autoPacking&&(o||s)&&"undefined"!=typeof document&&(this._canvas=this._canvas||document.createElement("canvas"),this._updateAutoPacking(o))}},{key:"_updateIconAtlas",value:function(t){this._texture&&(this._texture.delete(),this._texture=null),t instanceof x.a?(t.setParameters(C),this._externalTexture=t,this.onUpdate()):t&&(this._texture=new x.a(this.gl,{data:t,parameters:C}),this.onUpdate())}},{key:"_updateAutoPacking",value:function(t){var e,n,i,a,o,s,r=Object.values(function(t,e,n){if(!t||!e)return null;n=n||{};var i={},a=Object(P.a)(t),o=a.iterable,s=a.objectInfo,r=!0,c=!1,l=void 0;try{for(var u,f=o[Symbol.iterator]();!(r=(u=f.next()).done);r=!0){var h=u.value;s.index++;var p=e(h,s),g=z(p);if(!p)throw new Error("Icon is missing.");if(!p.url)throw new Error("Icon url is missing.");i[g]||n[g]&&p.url===n[g].url||(i[g]=p)}}catch(d){c=!0,l=d}finally{try{r||null==f.return||f.return()}finally{if(c)throw l}}return i}(t,this._getIcon,this._mapping)||{});if(r.length>0){var c=function(t){for(var e,n=t.icons,i=t.buffer,a=t.mapping,o=void 0===a?{}:a,s=t.xOffset,r=void 0===s?0:s,c=t.yOffset,l=void 0===c?0:c,u=t.rowHeight,f=void 0===u?0:u,h=t.canvasWidth,p=[],g=0;g<n.length;g++){var d=n[g];if(!o[z(d)]){var v=d.height,y=d.width;r+y+i>h&&(I(o,p,l),r=0,l=f+l+i,f=0,p=[]),p.push({icon:d,xOffset:r}),r=r+y+i,f=Math.max(f,v)}}return p.length>0&&I(o,p,l),{mapping:o,rowHeight:f,xOffset:r,yOffset:l,canvasWidth:h,canvasHeight:(e=f+l+i,Math.pow(2,Math.ceil(Math.log2(e))))}}({icons:r,buffer:this._buffer,canvasWidth:this._canvasWidth,mapping:this._mapping,rowHeight:this._rowHeight,xOffset:this._xOffset,yOffset:this._yOffset}),l=c.mapping,u=c.xOffset,f=c.yOffset,h=c.rowHeight,p=c.canvasHeight;this._rowHeight=h,this._mapping=l,this._xOffset=u,this._yOffset=f,this._canvasHeight=p,this._texture||(this._texture=new x.a(this.gl,{width:this._canvasWidth,height:this._canvasHeight,parameters:C})),this._texture.height!==this._canvasHeight&&(this._texture=(this.gl,e=this._texture,n=this._canvasWidth,i=this._canvasHeight,a=e.width,o=e.height,s=Object(m.a)(e,{width:n,height:i}),Object(_.b)(e,s,{targetY:0,width:a,height:o}),e.delete(),s)),this.onUpdate(),this._loadIcons(r)}}},{key:"_loadIcons",value:function(t){var e=this,n=this._canvas.getContext("2d"),i=!0,a=!1,o=void 0;try{for(var s,r=function(){var t=s.value;e._pendingCount++,Object(O.a)(t.url,b.a,e._loadOptions).then((function(i){var a=z(t),o=e._mapping[a],s=o.x,r=o.y,c=o.width,l=o.height,u=function(t,e,n,i){return n===e.width&&i===e.height?e:(t.canvas.height=i,t.canvas.width=n,t.clearRect(0,0,t.canvas.width,t.canvas.height),t.drawImage(e,0,0,e.width,e.height,0,0,n,i),t.canvas)}(n,i,c,l);e._texture.setSubImageData({data:u,x:s,y:r,width:c,height:l}),e._texture.generateMipmap(),e.onUpdate()})).catch((function(t){w.a.error(t)()})).finally((function(){e._pendingCount--}))},c=t[Symbol.iterator]();!(i=(s=c.next()).done);i=!0)r()}catch(l){a=!0,o=l}finally{try{i||null==c.return||c.return()}finally{if(a)throw o}}}},{key:"isLoaded",get:function(){return 0===this._pendingCount}}]),t}(),S=[0,0,0,255],k={iconAtlas:{type:"object",value:null,async:!0},iconMapping:{type:"object",value:{},async:!0},sizeScale:{type:"number",value:1,min:0},billboard:!0,sizeUnits:"pixels",sizeMinPixels:{type:"number",min:0,value:0},sizeMaxPixels:{type:"number",min:0,value:Number.MAX_SAFE_INTEGER},alphaCutoff:{type:"number",value:.05,min:0,max:1},getPosition:{type:"accessor",value:function(t){return t.position}},getIcon:{type:"accessor",value:function(t){return t.icon}},getColor:{type:"accessor",value:S},getSize:{type:"accessor",value:1},getAngle:{type:"accessor",value:0},getPixelOffset:{type:"accessor",value:[0,0]}},L=function(t){function e(){return Object(s.a)(this,e),Object(c.a)(this,Object(l.a)(e).apply(this,arguments))}return Object(f.a)(e,t),Object(r.a)(e,[{key:"getShaders",value:function(){return Object(u.a)(Object(l.a)(e.prototype),"getShaders",this).call(this,{vs:"#define SHADER_NAME icon-layer-vertex-shader\n\nattribute vec2 positions;\n\nattribute vec3 instancePositions;\nattribute vec3 instancePositions64Low;\nattribute float instanceSizes;\nattribute float instanceAngles;\nattribute vec4 instanceColors;\nattribute vec3 instancePickingColors;\nattribute vec4 instanceIconFrames;\nattribute float instanceColorModes;\nattribute vec2 instanceOffsets;\nattribute vec2 instancePixelOffset;\n\nuniform float sizeScale;\nuniform vec2 iconsTextureDim;\nuniform float sizeMinPixels;\nuniform float sizeMaxPixels;\nuniform bool billboard;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nvec2 rotate_by_angle(vec2 vertex, float angle) {\n  float angle_radian = angle * PI / 180.0;\n  float cos_angle = cos(angle_radian);\n  float sin_angle = sin(angle_radian);\n  mat2 rotationMatrix = mat2(cos_angle, -sin_angle, sin_angle, cos_angle);\n  return rotationMatrix * vertex;\n}\n\nvoid main(void) {\n  geometry.worldPosition = instancePositions;\n  geometry.uv = positions;\n  geometry.pickingColor = instancePickingColors;\n  uv = positions;\n\n  vec2 iconSize = instanceIconFrames.zw;\n  float sizePixels = clamp(\n    project_size_to_pixel(instanceSizes * sizeScale), \n    sizeMinPixels, sizeMaxPixels\n  );\n  float instanceScale = iconSize.y == 0.0 ? 0.0 : sizePixels / iconSize.y;\n  vec2 pixelOffset = positions / 2.0 * iconSize + instanceOffsets;\n  pixelOffset = rotate_by_angle(pixelOffset, instanceAngles) * instanceScale;\n  pixelOffset += instancePixelOffset;\n  pixelOffset.y *= -1.0;\n\n  if (billboard)  {\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, vec3(0.0), geometry.position);\n    vec3 offset = vec3(pixelOffset, 0.0);\n    DECKGL_FILTER_SIZE(offset, geometry);\n    gl_Position.xy += project_pixel_size_to_clipspace(offset.xy);\n\n  } else {\n    vec3 offset_common = vec3(project_pixel_size(pixelOffset), 0.0);\n    DECKGL_FILTER_SIZE(offset_common, geometry);\n    gl_Position = project_position_to_clipspace(instancePositions, instancePositions64Low, offset_common, geometry.position); \n  }\n  DECKGL_FILTER_GL_POSITION(gl_Position, geometry);\n\n  vTextureCoords = mix(\n    instanceIconFrames.xy,\n    instanceIconFrames.xy + iconSize,\n    (positions.xy + 1.0) / 2.0\n  ) / iconsTextureDim;\n\n  vColor = instanceColors;\n  DECKGL_FILTER_COLOR(vColor, geometry);\n\n  vColorMode = instanceColorModes;\n}\n",fs:"#define SHADER_NAME icon-layer-fragment-shader\n\nprecision highp float;\n\nuniform float opacity;\nuniform sampler2D iconsTexture;\nuniform float alphaCutoff;\n\nvarying float vColorMode;\nvarying vec4 vColor;\nvarying vec2 vTextureCoords;\nvarying vec2 uv;\n\nvoid main(void) {\n  geometry.uv = uv;\n\n  vec4 texColor = texture2D(iconsTexture, vTextureCoords);\n  vec3 color = mix(texColor.rgb, vColor.rgb, vColorMode);\n  float a = texColor.a * opacity * vColor.a;\n\n  if (a < alphaCutoff) {\n    discard;\n  }\n\n  gl_FragColor = vec4(color, a);\n  DECKGL_FILTER_COLOR(gl_FragColor, geometry);\n}\n",modules:[h.a,p.a]})}},{key:"initializeState",value:function(){var t=this;this.state={iconManager:new j(this.context.gl,{onUpdate:function(){return t._onUpdate()}})},this.getAttributeManager().addInstanced({instancePositions:{size:3,type:5130,fp64:this.use64bitPositions(),transition:!0,accessor:"getPosition"},instanceSizes:{size:1,transition:!0,accessor:"getSize",defaultValue:1},instanceOffsets:{size:2,accessor:"getIcon",transform:this.getInstanceOffset},instanceIconFrames:{size:4,accessor:"getIcon",transform:this.getInstanceIconFrame},instanceColorModes:{size:1,type:5121,accessor:"getIcon",transform:this.getInstanceColorMode},instanceColors:{size:this.props.colorFormat.length,type:5121,normalized:!0,transition:!0,accessor:"getColor",defaultValue:S},instanceAngles:{size:1,transition:!0,accessor:"getAngle"},instancePixelOffset:{size:2,transition:!0,accessor:"getPixelOffset"}})}},{key:"updateState",value:function(t){var n=t.oldProps,i=t.props,a=t.changeFlags;Object(u.a)(Object(l.a)(e.prototype),"updateState",this).call(this,{props:i,oldProps:n,changeFlags:a});var o=this.getAttributeManager(),s=i.iconAtlas,r=i.iconMapping,c=i.data,f=i.getIcon,h=this.state.iconManager;h.setProps({loadOptions:i.loadOptions});var p=!1;if(s||this.internalState.isAsyncPropLoading("iconAtlas")?(n.iconAtlas!==i.iconAtlas&&h.setProps({iconAtlas:s,autoPacking:!1}),n.iconMapping!==i.iconMapping&&(h.setProps({iconMapping:r}),p=!0)):h.setProps({autoPacking:!0}),(a.dataChanged||a.updateTriggersChanged&&(a.updateTriggersChanged.all||a.updateTriggersChanged.getIcon))&&(h.setProps({data:c,getIcon:f}),p=!0),p&&(o.invalidate("instanceOffsets"),o.invalidate("instanceIconFrames"),o.invalidate("instanceColorModes")),a.extensionsChanged){var g=this.context.gl;this.state.model&&this.state.model.delete(),this.setState({model:this._getModel(g)}),o.invalidateAll()}}},{key:"finalizeState",value:function(){Object(u.a)(Object(l.a)(e.prototype),"finalizeState",this).call(this),this.state.iconManager.finalize()}},{key:"draw",value:function(t){var e=t.uniforms,n=this.props,i=n.sizeScale,a=n.sizeMinPixels,o=n.sizeMaxPixels,s=n.sizeUnits,r=n.billboard,c=n.alphaCutoff,l=this.state.iconManager,u=this.context.viewport,f=l.getTexture();f&&f.loaded&&this.state.model.setUniforms(Object.assign({},e,{iconsTexture:f,iconsTextureDim:[f.width,f.height],sizeScale:i*("pixels"===s?u.metersPerPixel:1),sizeMinPixels:a,sizeMaxPixels:o,billboard:r,alphaCutoff:c})).draw()}},{key:"_getModel",value:function(t){return new d.a(t,Object.assign({},this.getShaders(),{id:this.props.id,geometry:new v.a({drawMode:6,attributes:{positions:{size:2,value:new Float32Array([-1,-1,-1,1,1,1,1,-1])}}}),isInstanced:!0}))}},{key:"_onUpdate",value:function(){this.setNeedsRedraw()}},{key:"getInstanceOffset",value:function(t){var e=this.state.iconManager.getIconMapping(t);return[e.width/2-e.anchorX||0,e.height/2-e.anchorY||0]}},{key:"getInstanceColorMode",value:function(t){return this.state.iconManager.getIconMapping(t).mask?1:0}},{key:"getInstanceIconFrame",value:function(t){var e=this.state.iconManager.getIconMapping(t);return[e.x||0,e.y||0,e.width||0,e.height||0]}},{key:"isLoaded",get:function(){return Object(u.a)(Object(l.a)(e.prototype),"isLoaded",this)&&this.state.iconManager.isLoaded}}]),e}(g.a);L.layerName="IconLayer",L.defaultProps=k;var T=n("/PUF"),A=n("ERkP"),E=n.n(A),F=function(t){function e(e){var n;return(n=t.call(this,e)||this).state={data:[]},n.onHover=function(t){var e=t.x,i=t.y,a=t.object;n.setState({x:e,y:i,hoveredObject:a})},n.deckLayer=null,n.viewState={center:[-35,36.7],zoom:2.8,pitch:40.5,bearing:-27},n}Object(a.a)(e,t);var n=e.prototype;return n.initMap=function(){t.prototype.initMap.call(this),this._renderLayers()},n.componentWillUnmount=function(){this.deckLayer&&this.deckLayer.remove(),t.prototype.componentWillUnmount.call(this)},n.renderTooltip=function(){var t=this.state,e=t.x,n=t.y,i=t.hoveredObject;return i&&E.a.createElement("div",{className:"tooltip",style:{top:n,left:e}},i.name," ",i.year?"("+i.year+")":"")},n._renderLayers=function(){var t={layers:[new L({id:"icon",getIcon:function(){return"marker"},sizeUnits:"meters",sizeScale:5e3,sizeMinPixels:6,data:"https://raw.githubusercontent.com/visgl/deck.gl-data/master/examples/icon/meteorites.json",pickable:!0,wrapLongitude:!0,getPosition:function(t){return t.coordinates},iconAtlas:"./images/location-icon-atlas.png",iconMapping:"./json/location-icon-mapping.json",onHover:this.onHover})]};this.deckLayer?this.deckLayer.setProps(t):(this.deckLayer=new o.a("deck",t,{animation:!0,forceRenderOnMoving:!0,forceRenderOnZooming:!0,renderStart:function(){}}),this.map.addLayer(this.deckLayer))},e}(T.default);e.default=F},Qzre:function(t,e,n){var i=n("FXyv"),a=n("hpdy"),o=n("fVMg")("species");t.exports=function(t,e){var n,s=i(t).constructor;return void 0===s||null==(n=i(s)[o])?e:a(n)}},TbR9:function(t,e,n){var i=n("56Cj");t.exports=i&&!Symbol.sham&&"symbol"==typeof Symbol.iterator},fVMg:function(t,e,n){var i=n("9JhN"),a=n("TN3B"),o=n("8aeu"),s=n("HYrn"),r=n("56Cj"),c=n("TbR9"),l=a("wks"),u=i.Symbol,f=c?u:u&&u.withoutSetter||s;t.exports=function(t){return o(l,t)||(r&&o(u,t)?l[t]=u[t]:l[t]=f("Symbol."+t)),l[t]}},hpdy:function(t,e){t.exports=function(t){if("function"!=typeof t)throw TypeError(String(t)+" is not a function");return t}},iByj:function(t,e,n){"use strict";var i=n("hpdy"),a=function(t){var e,n;this.promise=new t((function(t,i){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=i})),this.resolve=i(e),this.reject=i(n)};t.exports.f=function(t){return new a(t)}},nDYR:function(t,e,n){var i=n("FXyv"),a=n("dSaG"),o=n("iByj");t.exports=function(t,e){if(i(t),a(e)&&e.constructor===t)return e;var n=o.f(t);return(0,n.resolve)(e),n.promise}}}]);
//# sourceMappingURL=component---src-pages-icon-layer-tsx-47c03277033a7dae556b.js.map